// https://leetcode.com/problems/different-ways-to-add-parentheses/

pub struct Solution;

impl Solution {
    pub fn diff_ways_to_compute(expression: String) -> Vec<i32> {
        fn compute_product_of_input_operands(left: &[i32], right: &[i32], op: u8) -> Vec<i32> {
            let mut result = Vec::new();
            for &l in left {
                for &r in right {
                    result.push(match op {
                        b'+' => l + r,
                        b'-' => l - r,
                        b'*' => l * r,
                        _ => unreachable!(),
                    });
                }
            }
            result
        }
        fn rec<'a>(
            expression: &'a str,
            cache: &mut std::collections::HashMap<&'a str, Vec<i32>>,
        ) -> Vec<i32> {
            if let Some(result) = cache.get(expression) {
                return result.clone();
            }
            let mut result = Vec::new();
            for (i, b) in expression.bytes().enumerate() {
                if b == b'+' || b == b'-' || b == b'*' {
                    let left = rec(&expression[..i], cache);
                    let right = rec(&expression[i + 1..], cache);
                    result.extend(compute_product_of_input_operands(&left, &right, b));
                }
            }
            if result.is_empty() {
                result.push(expression.parse().unwrap());
            }
            cache.insert(expression, result.clone());
            result
        }
        rec(&expression, &mut std::collections::HashMap::new())
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    fn test(expression: &str, expected: &[i32]) {
        assert!(expression.len() >= 1);
        assert!(expression.len() <= 20);
        assert!(expected.len() >= 1);
        assert!(expected.len() <= 10_000);
        let mut result = Solution::diff_ways_to_compute(expression.to_string());
        let mut expected_sorted = expected.to_vec();
        result.sort_unstable();
        expected_sorted.sort_unstable();
        assert_eq!(result, expected_sorted);
    }

    #[test]
    fn ex1() {
        test("2-1-1", &[0, 2])
    }

    #[test]
    fn ex2() {
        test("2*3-4*5", &[-34, -14, -10, -10, 10])
    }

    #[test]
    fn discussion_case0() {
        test("0-0", &[0])
    }

    #[test]
    fn discussion_case99() {
        test("99", &[99])
    }

    #[test]
    fn discussion_case1() {
        test(
            "99*87-78+66*55-44+33",
            &[
                144639, -286605, -350856, -74250, -357390, 322245, -618651, -350856, -767844,
                -74250, -357390, -151470, -357390, -774378, -142857, 288387, 352638, 76032, 359172,
                124146, -248292, -163350, 326700, -366102, -783090, 352638, -317988, 400752,
                -67716, -350856, -144936, -350856, -767844, 76032, 359172, -58806, 84942, -359568,
                -776556, 359172, -311454, 407286, 9987, 5631, 4982, 7776, 4916, 11781, 2277, 4982,
                770, 7776, 4916, 6996, 4916, 704, -561, 3795, 4444, 1650, 4510, 7083, 11439, 12088,
                9294, 12154, 124146, -248292, -163350, 326700, -186318, 372636, -21054, 42108,
                -189222, 378444, -358556, -775544, 360184, -310442, 408298, 4828, 616, 4444, 12088,
                -310442, 408298, 465718, 52558, 472978, -70950, -354090, -148170, -354090, -771078,
                72798, 355938, -62040, 81708, -362802, -779790, 355938, -314688, 404052, 7842,
                4982, 7062, 4982, 770, 1650, 4510, 9294, 12154, -62040, 81708, 93192, 10560, 94644,
                -358490, -775478, 360250, -310376, 408364, 4894, 682, 4510, 12154, -310376, 408364,
                465784, 52624, 473044,
            ],
        )
    }

    #[test]
    fn discussion_case2() {
        test(
            "1+2-3+4-5+6-7+8-9+10",
            &[
                11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7, 9, 11, -9, 11, -9, -9, -11, 9,
                -11, 9, -27, -11, -27, -11, -11, 11, 11, 9, -7, 9, 11, 11, 9, 9, -7, 9, -7, 9, 9,
                -9, 11, -9, 11, 11, 13, -7, 29, 13, -9, -9, -7, 9, -7, 3, 23, 3, 23, 23, -9, 11,
                -9, 11, 11, 11, -9, 11, -9, 13, -7, 25, 5, 13, -7, 11, 27, 11, 27, 27, 29, 13, 41,
                29, 11, 11, 13, 25, 13, -9, -9, -11, -27, -11, -9, -9, -11, -11, -27, -11, -27,
                -11, -11, -9, -9, -7, 9, -7, 3, 3, -9, -9, -9, -9, -7, 5, -7, -9, 7, -9, 7, 7, 9,
                -7, 21, 9, -9, -9, -7, 5, -7, 11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7,
                9, 11, -9, 11, -9, -9, -11, 9, -11, 9, -27, -11, -27, -11, -11, 11, 11, 9, -7, 9,
                11, 11, 9, 9, -7, 9, -7, 9, 9, -9, 11, -9, 11, 11, 13, -7, 29, 13, -9, -9, -7, 9,
                -7, -9, 11, -9, 11, 11, 13, -7, 29, 13, -9, -9, -7, 9, -7, 3, 23, 3, 23, 23, -9,
                11, -9, 11, 11, 3, 23, 3, 23, 23, -9, 11, -9, 11, 11, -9, 11, -9, 11, 11, 11, -9,
                11, -9, 13, -7, 25, 5, 13, -7, 11, -9, 11, -9, 13, -7, 13, -7, 25, 5, 13, -7, 25,
                5, 13, -7, 13, -7, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13, 11, 27,
                11, 27, 27, 29, 13, 29, 13, 41, 29, 41, 29, 29, 11, 11, 13, 25, 13, 11, 11, 13, 13,
                25, 13, 25, 13, 13, -9, -9, -11, -27, -11, -9, -9, -11, -11, -27, -11, -27, -11,
                -11, -9, -9, -7, 9, -7, 3, 3, -9, -9, -9, -9, -7, 5, -7, -9, 7, -9, 7, 7, 9, -7,
                21, 9, -9, -9, -7, 5, -7, -9, -9, -11, -27, -11, -9, -9, -11, -11, -27, -11, -27,
                -11, -11, -9, -9, -7, 9, -7, -9, -9, -7, 9, -7, 3, 3, -9, -9, 3, 3, -9, -9, -9, -9,
                -9, -9, -7, 5, -7, -9, -9, -7, -7, 5, -7, 5, -7, -7, -9, 7, -9, 7, 7, 9, -7, 21, 9,
                -9, -9, -7, 5, -7, -9, 7, -9, 7, 7, 9, -7, 9, -7, 21, 9, 21, 9, 9, -9, -9, -7, 5,
                -7, -9, -9, -7, -7, 5, -7, 5, -7, -7, -11, 9, -11, 9, 9, 11, -9, 27, 11, -11, -11,
                -9, 7, -9, -11, 9, -11, 9, 9, 11, -9, 11, -9, 27, 11, 27, 11, 11, -11, -11, -9, 7,
                -9, -11, -11, -9, -9, 7, -9, 7, -9, -9, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9,
                9, 7, -9, 7, -3, -23, -3, -23, -23, 9, -11, 9, -11, -11, -11, 9, -11, 9, -13, 7,
                -25, -5, -13, 7, -11, -27, -11, -27, -27, -29, -13, -41, -29, -11, -11, -13, -25,
                -13, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9, 7, -9, 7, -3, -3, 9,
                9, 9, 9, 7, -5, 7, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, -19, 1, -19,
                1, 1, 3, -17, 19, 3, -19, -19, -17, -1, -17, -19, 1, -19, 1, 1, 3, -17, 3, -17, 19,
                3, 19, 3, 3, -19, -19, -17, -1, -17, -19, -19, -17, -17, -1, -17, -1, -17, -17,
                -11, 9, -11, 9, 9, 11, -9, 27, 11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11, -9,
                11, -9, 27, 11, 27, 11, 11, -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7, -9,
                -9, 11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7, 9, 11, -9, 11, -9, -9,
                -11, 9, -27, -11, 11, 11, 9, -7, 9, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9, 9, 7,
                -9, 7, 1, -19, 1, -19, -19, -21, -1, -37, -21, 1, 1, -1, -17, -1, 9, -11, 9, -11,
                -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, 11, -9, 11, -9, -9, -1, -21, -1, -21, -21,
                11, -9, 11, -9, -9, -1, -21, -1, -21, -21, -1, -21, -1, -21, -21, -3, -23, -3, -23,
                -23, 9, -11, 9, -11, -11, -11, -31, -11, -31, -31, -3, -23, -3, -23, -23, 11, -9,
                11, -9, -9, 11, -9, 11, -9, -9, 9, -11, 9, -11, -11, 1, -19, 1, -19, -19, 9, -11,
                9, -11, -11, -11, 9, -11, 9, -9, 11, 3, 23, -9, 11, -11, 9, -11, 9, -9, 11, -9, 11,
                3, 23, -9, 11, 3, 23, -9, 11, -9, 11, -11, 9, -11, 9, -13, 7, -25, -5, -13, 7, -19,
                1, -19, 1, -11, 9, -11, 9, -11, 9, -11, 9, -13, 7, -21, -1, -13, 7, -11, 9, -23,
                -3, -11, 9, -23, -3, -23, -3, -25, -5, -13, 7, -33, -13, -25, -5, -11, 9, -11, 9,
                -13, 7, -21, -1, -13, 7, -27, -11, -27, -11, -11, -9, -25, 3, -9, -27, -27, -25,
                -13, -25, -27, -11, -27, -11, -11, -9, -25, -9, -25, 3, -9, 3, -9, -9, -27, -27,
                -25, -13, -25, -27, -27, -25, -25, -13, -25, -13, -25, -25, -11, -27, -11, -27,
                -27, -29, -13, -41, -29, -11, -11, -13, -25, -13, -19, -35, -19, -35, -35, -11,
                -27, -11, -27, -27, -27, -11, -27, -11, -29, -13, -37, -21, -29, -13, -27, -39,
                -27, -39, -39, -41, -29, -49, -41, -27, -27, -29, -37, -29, -11, -11, -9, 3, -9,
                -11, -11, -9, -9, 3, -9, 3, -9, -9, -11, -11, -13, -25, -13, -19, -19, -11, -11,
                -11, -11, -13, -21, -13, -11, -23, -11, -23, -23, -25, -13, -33, -25, -11, -11,
                -13, -21, -13, 11, 11, 9, -7, 9, 11, 11, 9, 9, -7, 9, -7, 9, 9, 11, 11, 13, 29, 13,
                23, 23, 11, 11, 11, 11, 13, 25, 13, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13,
                25, 13, 11, 11, 9, -7, 9, 11, 11, 9, 9, -7, 9, -7, 9, 9, 11, 11, 13, 29, 13, 11,
                11, 13, 29, 13, 23, 23, 11, 11, 23, 23, 11, 11, 11, 11, 11, 11, 13, 25, 13, 11, 11,
                13, 13, 25, 13, 25, 13, 13, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13,
                11, 27, 11, 27, 27, 29, 13, 29, 13, 41, 29, 41, 29, 29, 11, 11, 13, 25, 13, 11, 11,
                13, 13, 25, 13, 25, 13, 13, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9,
                9, 7, -9, 7, -3, -3, 9, 9, 9, 9, 7, -5, 7, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9,
                7, -5, 7, 1, 1, 3, 19, 3, 1, 1, 3, 3, 19, 3, 19, 3, 3, 9, 9, 11, 27, 11, 9, 9, 11,
                11, 27, 11, 27, 11, 11, 11, 11, 9, -7, 9, 11, 11, 9, -7, 9, 9, 9, 7, -9, 7, 1, 1,
                -1, -17, -1, 9, 9, 7, -9, 7, 11, 11, -1, -1, 11, 11, -1, -1, -1, -1, -3, -3, 9, 9,
                -11, -11, -3, -3, 11, 11, 11, 11, 9, 9, 1, 1, 9, 9, 9, 9, 11, 23, 11, 9, 9, 11, 11,
                23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 1, 1, 9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3,
                -5, 7, -13, -5, 9, 9, 7, -1, 7, -7, 9, -7, 9, 9, 11, -5, 23, 11, -7, -7, -5, 7, -5,
                -7, 9, -7, 9, 9, 11, -5, 11, -5, 23, 11, 23, 11, 11, -7, -7, -5, 7, -5, -7, -7, -5,
                -5, 7, -5, 7, -5, -5, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 1, -15, 1,
                -15, -15, 9, -7, 9, -7, -7, -7, 9, -7, 9, -9, 7, -17, -1, -9, 7, -7, -19, -7, -19,
                -19, -21, -9, -29, -21, -7, -7, -9, -17, -9, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23,
                11, 23, 11, 11, 9, 9, 7, -5, 7, 1, 1, 9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3, -5,
                7, -13, -5, 9, 9, 7, -1, 7, 11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7, 9,
                11, -9, 11, -9, -9, -11, 9, -11, 9, -27, -11, -27, -11, -11, 11, 11, 9, -7, 9, 11,
                11, 9, 9, -7, 9, -7, 9, 9, -9, 11, -9, 11, 11, 13, -7, 29, 13, -9, -9, -7, 9, -7,
                3, 23, 3, 23, 23, -9, 11, -9, 11, 11, 11, -9, 11, -9, 13, -7, 25, 5, 13, -7, 11,
                27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13, -9, -9, -11, -27, -11, -9, -9,
                -11, -11, -27, -11, -27, -11, -11, -9, -9, -7, 9, -7, 3, 3, -9, -9, -9, -9, -7, 5,
                -7, -9, 7, -9, 7, 7, 9, -7, 21, 9, -9, -9, -7, 5, -7, 11, -9, 11, -9, -9, -11, 9,
                -27, -11, 11, 11, 9, -7, 9, 11, -9, 11, -9, -9, -11, 9, -11, 9, -27, -11, -27, -11,
                -11, 11, 11, 9, -7, 9, 11, 11, 9, 9, -7, 9, -7, 9, 9, -9, 11, -9, 11, 11, 13, -7,
                29, 13, -9, -9, -7, 9, -7, -9, 11, -9, 11, 11, 13, -7, 29, 13, -9, -9, -7, 9, -7,
                3, 23, 3, 23, 23, -9, 11, -9, 11, 11, 3, 23, 3, 23, 23, -9, 11, -9, 11, 11, -9, 11,
                -9, 11, 11, 11, -9, 11, -9, 13, -7, 25, 5, 13, -7, 11, -9, 11, -9, 13, -7, 13, -7,
                25, 5, 13, -7, 25, 5, 13, -7, 13, -7, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11,
                13, 25, 13, 11, 27, 11, 27, 27, 29, 13, 29, 13, 41, 29, 41, 29, 29, 11, 11, 13, 25,
                13, 11, 11, 13, 13, 25, 13, 25, 13, 13, -9, -9, -11, -27, -11, -9, -9, -11, -11,
                -27, -11, -27, -11, -11, -9, -9, -7, 9, -7, 3, 3, -9, -9, -9, -9, -7, 5, -7, -9, 7,
                -9, 7, 7, 9, -7, 21, 9, -9, -9, -7, 5, -7, -9, -9, -11, -27, -11, -9, -9, -11, -11,
                -27, -11, -27, -11, -11, -9, -9, -7, 9, -7, -9, -9, -7, 9, -7, 3, 3, -9, -9, 3, 3,
                -9, -9, -9, -9, -9, -9, -7, 5, -7, -9, -9, -7, -7, 5, -7, 5, -7, -7, -9, 7, -9, 7,
                7, 9, -7, 21, 9, -9, -9, -7, 5, -7, -9, 7, -9, 7, 7, 9, -7, 9, -7, 21, 9, 21, 9, 9,
                -9, -9, -7, 5, -7, -9, -9, -7, -7, 5, -7, 5, -7, -7, -11, 9, -11, 9, 9, 11, -9, 27,
                11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11, -9, 11, -9, 27, 11, 27, 11, 11,
                -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7, -9, -9, 9, -11, 9, -11, -11, -13,
                7, -29, -13, 9, 9, 7, -9, 7, -3, -23, -3, -23, -23, 9, -11, 9, -11, -11, -11, 9,
                -11, 9, -13, 7, -25, -5, -13, 7, -11, -27, -11, -27, -27, -29, -13, -41, -29, -11,
                -11, -13, -25, -13, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9, 7,
                -9, 7, -3, -3, 9, 9, 9, 9, 7, -5, 7, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5,
                7, -11, 9, -11, 9, 9, 11, -9, 27, 11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11,
                -9, 11, -9, 27, 11, 27, 11, 11, -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7,
                -9, -9, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, -3, -23, -3, -23,
                -23, 9, -11, 9, -11, -11, -11, 9, -11, 9, -13, 7, -25, -5, -13, 7, -11, -27, -11,
                -27, -27, -29, -13, -41, -29, -11, -11, -13, -25, -13, 9, 9, 11, 27, 11, 9, 9, 11,
                11, 27, 11, 27, 11, 11, 9, 9, 7, -9, 7, -3, -3, 9, 9, 9, 9, 7, -5, 7, 9, -7, 9, -7,
                -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, -19, 1, -19, 1, 1, 3, -17, 19, 3, -19, -19,
                -17, -1, -17, -19, 1, -19, 1, 1, 3, -17, 3, -17, 19, 3, 19, 3, 3, -19, -19, -17,
                -1, -17, -19, -19, -17, -17, -1, -17, -1, -17, -17, -11, 9, -11, 9, 9, 11, -9, 27,
                11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11, -9, 11, -9, 27, 11, 27, 11, 11,
                -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7, -9, -9, -19, 1, -19, 1, 1, 3, -17,
                19, 3, -19, -19, -17, -1, -17, -19, 1, -19, 1, 1, 3, -17, 3, -17, 19, 3, 19, 3, 3,
                -19, -19, -17, -1, -17, -19, -19, -17, -17, -1, -17, -1, -17, -17, -11, 9, -11, 9,
                9, 11, -9, 27, 11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11, -9, 11, -9, 27, 11,
                27, 11, 11, -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7, -9, -9, -11, 9, -11,
                9, 9, 11, -9, 27, 11, -11, -11, -9, 7, -9, -11, 9, -11, 9, 9, 11, -9, 11, -9, 27,
                11, 27, 11, 11, -11, -11, -9, 7, -9, -11, -11, -9, -9, 7, -9, 7, -9, -9, 11, -9,
                11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7, 9, 11, -9, 11, -9, -9, -11, 9, -27,
                -11, 11, 11, 9, -7, 9, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, 1,
                -19, 1, -19, -19, -21, -1, -37, -21, 1, 1, -1, -17, -1, 9, -11, 9, -11, -11, -13,
                7, -29, -13, 9, 9, 7, -9, 7, 11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7,
                9, 11, -9, 11, -9, -9, -11, 9, -27, -11, 11, 11, 9, -7, 9, 9, -11, 9, -11, -11,
                -13, 7, -29, -13, 9, 9, 7, -9, 7, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9, 9, 7,
                -9, 7, 1, -19, 1, -19, -19, -21, -1, -37, -21, 1, 1, -1, -17, -1, 9, -11, 9, -11,
                -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, 1, -19, 1, -19, -19, -21, -1, -37, -21, 1,
                1, -1, -17, -1, 9, -11, 9, -11, -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, 9, -11, 9,
                -11, -11, -13, 7, -29, -13, 9, 9, 7, -9, 7, 11, -9, 11, -9, -9, -1, -21, -1, -21,
                -21, 11, -9, 11, -9, -9, -1, -21, -1, -21, -21, -1, -21, -1, -21, -21, -3, -23, -3,
                -23, -23, 9, -11, 9, -11, -11, -11, -31, -11, -31, -31, -3, -23, -3, -23, -23, 11,
                -9, 11, -9, -9, 11, -9, 11, -9, -9, 9, -11, 9, -11, -11, 1, -19, 1, -19, -19, 9,
                -11, 9, -11, -11, 11, -9, 11, -9, -9, -1, -21, -1, -21, -21, 11, -9, 11, -9, -9,
                -1, -21, -1, -21, -21, -1, -21, -1, -21, -21, -3, -23, -3, -23, -23, 9, -11, 9,
                -11, -11, -3, -23, -3, -23, -23, 9, -11, 9, -11, -11, -11, -31, -11, -31, -31, -3,
                -23, -3, -23, -23, -11, -31, -11, -31, -31, -3, -23, -3, -23, -23, -3, -23, -3,
                -23, -23, 11, -9, 11, -9, -9, 11, -9, 11, -9, -9, 9, -11, 9, -11, -11, 1, -19, 1,
                -19, -19, 9, -11, 9, -11, -11, 11, -9, 11, -9, -9, 11, -9, 11, -9, -9, 9, -11, 9,
                -11, -11, 9, -11, 9, -11, -11, 1, -19, 1, -19, -19, 9, -11, 9, -11, -11, 1, -19, 1,
                -19, -19, 9, -11, 9, -11, -11, 9, -11, 9, -11, -11, -11, 9, -11, 9, -9, 11, 3, 23,
                -9, 11, -11, 9, -11, 9, -9, 11, -9, 11, 3, 23, -9, 11, 3, 23, -9, 11, -9, 11, -11,
                9, -11, 9, -13, 7, -25, -5, -13, 7, -19, 1, -19, 1, -11, 9, -11, 9, -11, 9, -11, 9,
                -13, 7, -21, -1, -13, 7, -11, 9, -23, -3, -11, 9, -23, -3, -23, -3, -25, -5, -13,
                7, -33, -13, -25, -5, -11, 9, -11, 9, -13, 7, -21, -1, -13, 7, -11, 9, -11, 9, -9,
                11, 3, 23, -9, 11, -11, 9, -11, 9, -9, 11, -9, 11, 3, 23, -9, 11, 3, 23, -9, 11,
                -9, 11, -11, 9, -11, 9, -13, 7, -25, -5, -13, 7, -11, 9, -11, 9, -13, 7, -25, -5,
                -13, 7, -19, 1, -19, 1, -11, 9, -11, 9, -19, 1, -19, 1, -11, 9, -11, 9, -11, 9,
                -11, 9, -11, 9, -11, 9, -13, 7, -21, -1, -13, 7, -11, 9, -11, 9, -13, 7, -13, 7,
                -21, -1, -13, 7, -21, -1, -13, 7, -13, 7, -11, 9, -23, -3, -11, 9, -23, -3, -23,
                -3, -25, -5, -13, 7, -33, -13, -25, -5, -11, 9, -11, 9, -13, 7, -21, -1, -13, 7,
                -11, 9, -23, -3, -11, 9, -23, -3, -23, -3, -25, -5, -13, 7, -25, -5, -13, 7, -33,
                -13, -25, -5, -33, -13, -25, -5, -25, -5, -11, 9, -11, 9, -13, 7, -21, -1, -13, 7,
                -11, 9, -11, 9, -13, 7, -13, 7, -21, -1, -13, 7, -21, -1, -13, 7, -13, 7, -27, -11,
                -27, -11, -11, -9, -25, 3, -9, -27, -27, -25, -13, -25, -27, -11, -27, -11, -11,
                -9, -25, -9, -25, 3, -9, 3, -9, -9, -27, -27, -25, -13, -25, -27, -27, -25, -25,
                -13, -25, -13, -25, -25, -11, -27, -11, -27, -27, -29, -13, -41, -29, -11, -11,
                -13, -25, -13, -19, -35, -19, -35, -35, -11, -27, -11, -27, -27, -27, -11, -27,
                -11, -29, -13, -37, -21, -29, -13, -27, -39, -27, -39, -39, -41, -29, -49, -41,
                -27, -27, -29, -37, -29, -11, -11, -9, 3, -9, -11, -11, -9, -9, 3, -9, 3, -9, -9,
                -11, -11, -13, -25, -13, -19, -19, -11, -11, -11, -11, -13, -21, -13, -11, -23,
                -11, -23, -23, -25, -13, -33, -25, -11, -11, -13, -21, -13, -27, -11, -27, -11,
                -11, -9, -25, 3, -9, -27, -27, -25, -13, -25, -27, -11, -27, -11, -11, -9, -25, -9,
                -25, 3, -9, 3, -9, -9, -27, -27, -25, -13, -25, -27, -27, -25, -25, -13, -25, -13,
                -25, -25, -11, -27, -11, -27, -27, -29, -13, -41, -29, -11, -11, -13, -25, -13,
                -11, -27, -11, -27, -27, -29, -13, -41, -29, -11, -11, -13, -25, -13, -19, -35,
                -19, -35, -35, -11, -27, -11, -27, -27, -19, -35, -19, -35, -35, -11, -27, -11,
                -27, -27, -11, -27, -11, -27, -27, -27, -11, -27, -11, -29, -13, -37, -21, -29,
                -13, -27, -11, -27, -11, -29, -13, -29, -13, -37, -21, -29, -13, -37, -21, -29,
                -13, -29, -13, -27, -39, -27, -39, -39, -41, -29, -49, -41, -27, -27, -29, -37,
                -29, -27, -39, -27, -39, -39, -41, -29, -41, -29, -49, -41, -49, -41, -41, -27,
                -27, -29, -37, -29, -27, -27, -29, -29, -37, -29, -37, -29, -29, -11, -11, -9, 3,
                -9, -11, -11, -9, -9, 3, -9, 3, -9, -9, -11, -11, -13, -25, -13, -19, -19, -11,
                -11, -11, -11, -13, -21, -13, -11, -23, -11, -23, -23, -25, -13, -33, -25, -11,
                -11, -13, -21, -13, -11, -11, -9, 3, -9, -11, -11, -9, -9, 3, -9, 3, -9, -9, -11,
                -11, -13, -25, -13, -11, -11, -13, -25, -13, -19, -19, -11, -11, -19, -19, -11,
                -11, -11, -11, -11, -11, -13, -21, -13, -11, -11, -13, -13, -21, -13, -21, -13,
                -13, -11, -23, -11, -23, -23, -25, -13, -33, -25, -11, -11, -13, -21, -13, -11,
                -23, -11, -23, -23, -25, -13, -25, -13, -33, -25, -33, -25, -25, -11, -11, -13,
                -21, -13, -11, -11, -13, -13, -21, -13, -21, -13, -13, 11, 11, 9, -7, 9, 11, 11, 9,
                9, -7, 9, -7, 9, 9, 11, 11, 13, 29, 13, 23, 23, 11, 11, 11, 11, 13, 25, 13, 11, 27,
                11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13, 11, 11, 9, -7, 9, 11, 11, 9, 9, -7,
                9, -7, 9, 9, 11, 11, 13, 29, 13, 11, 11, 13, 29, 13, 23, 23, 11, 11, 23, 23, 11,
                11, 11, 11, 11, 11, 13, 25, 13, 11, 11, 13, 13, 25, 13, 25, 13, 13, 11, 27, 11, 27,
                27, 29, 13, 41, 29, 11, 11, 13, 25, 13, 11, 27, 11, 27, 27, 29, 13, 29, 13, 41, 29,
                41, 29, 29, 11, 11, 13, 25, 13, 11, 11, 13, 13, 25, 13, 25, 13, 13, 9, 9, 11, 27,
                11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9, 7, -9, 7, -3, -3, 9, 9, 9, 9, 7, -5, 7,
                9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 1, 1, 3, 19, 3, 1, 1, 3, 3, 19,
                3, 19, 3, 3, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 11, 11, 9, -7, 9,
                11, 11, 9, -7, 9, 9, 9, 7, -9, 7, 1, 1, -1, -17, -1, 9, 9, 7, -9, 7, 11, 11, -1,
                -1, 11, 11, -1, -1, -1, -1, -3, -3, 9, 9, -11, -11, -3, -3, 11, 11, 11, 11, 9, 9,
                1, 1, 9, 9, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 1,
                1, 9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1, 7, -7, 9,
                -7, 9, 9, 11, -5, 23, 11, -7, -7, -5, 7, -5, -7, 9, -7, 9, 9, 11, -5, 11, -5, 23,
                11, 23, 11, 11, -7, -7, -5, 7, -5, -7, -7, -5, -5, 7, -5, 7, -5, -5, 9, -7, 9, -7,
                -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 1, -15, 1, -15, -15, 9, -7, 9, -7, -7, -7, 9,
                -7, 9, -9, 7, -17, -1, -9, 7, -7, -19, -7, -19, -19, -21, -9, -29, -21, -7, -7, -9,
                -17, -9, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 1, 1,
                9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1, 7, 11, 11, 9,
                -7, 9, 11, 11, 9, 9, -7, 9, -7, 9, 9, 11, 11, 13, 29, 13, 23, 23, 11, 11, 11, 11,
                13, 25, 13, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13, 11, 11, 9, -7,
                9, 11, 11, 9, 9, -7, 9, -7, 9, 9, 11, 11, 13, 29, 13, 11, 11, 13, 29, 13, 23, 23,
                11, 11, 23, 23, 11, 11, 11, 11, 11, 11, 13, 25, 13, 11, 11, 13, 13, 25, 13, 25, 13,
                13, 11, 27, 11, 27, 27, 29, 13, 41, 29, 11, 11, 13, 25, 13, 11, 27, 11, 27, 27, 29,
                13, 29, 13, 41, 29, 41, 29, 29, 11, 11, 13, 25, 13, 11, 11, 13, 13, 25, 13, 25, 13,
                13, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9, 7, -9, 7, -3, -3, 9,
                9, 9, 9, 7, -5, 7, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 9, 9, 11, 27,
                11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9, 7, -9, 7, -3, -3, 9, 9, 9, 9, 7, -5, 7,
                9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 1, 1, 3, 19, 3, 1, 1, 3, 3, 19,
                3, 19, 3, 3, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 1, 1, 3, 19, 3, 1,
                1, 3, 3, 19, 3, 19, 3, 3, 9, 9, 11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 9, 9,
                11, 27, 11, 9, 9, 11, 11, 27, 11, 27, 11, 11, 11, 11, 9, -7, 9, 11, 11, 9, -7, 9,
                9, 9, 7, -9, 7, 1, 1, -1, -17, -1, 9, 9, 7, -9, 7, 11, 11, 9, -7, 9, 11, 11, 9, -7,
                9, 9, 9, 7, -9, 7, 9, 9, 7, -9, 7, 1, 1, -1, -17, -1, 9, 9, 7, -9, 7, 1, 1, -1,
                -17, -1, 9, 9, 7, -9, 7, 9, 9, 7, -9, 7, 11, 11, -1, -1, 11, 11, -1, -1, -1, -1,
                -3, -3, 9, 9, -11, -11, -3, -3, 11, 11, 11, 11, 9, 9, 1, 1, 9, 9, 11, 11, -1, -1,
                11, 11, -1, -1, -1, -1, -3, -3, 9, 9, -3, -3, 9, 9, -11, -11, -3, -3, -11, -11, -3,
                -3, -3, -3, 11, 11, 11, 11, 9, 9, 1, 1, 9, 9, 11, 11, 11, 11, 9, 9, 9, 9, 1, 1, 9,
                9, 1, 1, 9, 9, 9, 9, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11, 9, 9, 7,
                -5, 7, 1, 1, 9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1,
                7, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 9, 9, 7, -5,
                7, 1, 1, 9, 9, 1, 1, 9, 9, 9, 9, 9, 9, 7, -1, 7, 9, 9, 7, 7, -1, 7, -1, 7, 7, 9,
                -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3, -5, 7, -5, 7, -13,
                -5, -13, -5, -5, 9, 9, 7, -1, 7, 9, 9, 7, 7, -1, 7, -1, 7, 7, -7, 9, -7, 9, 9, 11,
                -5, 23, 11, -7, -7, -5, 7, -5, -7, 9, -7, 9, 9, 11, -5, 11, -5, 23, 11, 23, 11, 11,
                -7, -7, -5, 7, -5, -7, -7, -5, -5, 7, -5, 7, -5, -5, 9, -7, 9, -7, -7, -9, 7, -21,
                -9, 9, 9, 7, -5, 7, 1, -15, 1, -15, -15, 9, -7, 9, -7, -7, -7, 9, -7, 9, -9, 7,
                -17, -1, -9, 7, -7, -19, -7, -19, -19, -21, -9, -29, -21, -7, -7, -9, -17, -9, 9,
                9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 1, 1, 9, 9, 9, 9,
                7, -1, 7, 9, -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1, 7, -7, 9, -7, 9, 9, 11,
                -5, 23, 11, -7, -7, -5, 7, -5, -7, 9, -7, 9, 9, 11, -5, 11, -5, 23, 11, 23, 11, 11,
                -7, -7, -5, 7, -5, -7, -7, -5, -5, 7, -5, 7, -5, -5, 9, -7, 9, -7, -7, -9, 7, -21,
                -9, 9, 9, 7, -5, 7, 9, -7, 9, -7, -7, -9, 7, -21, -9, 9, 9, 7, -5, 7, 1, -15, 1,
                -15, -15, 9, -7, 9, -7, -7, 1, -15, 1, -15, -15, 9, -7, 9, -7, -7, 9, -7, 9, -7,
                -7, -7, 9, -7, 9, -9, 7, -17, -1, -9, 7, -7, 9, -7, 9, -9, 7, -9, 7, -17, -1, -9,
                7, -17, -1, -9, 7, -9, 7, -7, -19, -7, -19, -19, -21, -9, -29, -21, -7, -7, -9,
                -17, -9, -7, -19, -7, -19, -19, -21, -9, -21, -9, -29, -21, -29, -21, -21, -7, -7,
                -9, -17, -9, -7, -7, -9, -9, -17, -9, -17, -9, -9, 9, 9, 11, 23, 11, 9, 9, 11, 11,
                23, 11, 23, 11, 11, 9, 9, 7, -5, 7, 1, 1, 9, 9, 9, 9, 7, -1, 7, 9, -3, 9, -3, -3,
                -5, 7, -13, -5, 9, 9, 7, -1, 7, 9, 9, 11, 23, 11, 9, 9, 11, 11, 23, 11, 23, 11, 11,
                9, 9, 7, -5, 7, 9, 9, 7, -5, 7, 1, 1, 9, 9, 1, 1, 9, 9, 9, 9, 9, 9, 7, -1, 7, 9, 9,
                7, 7, -1, 7, -1, 7, 7, 9, -3, 9, -3, -3, -5, 7, -13, -5, 9, 9, 7, -1, 7, 9, -3, 9,
                -3, -3, -5, 7, -5, 7, -13, -5, -13, -5, -5, 9, 9, 7, -1, 7, 9, 9, 7, 7, -1, 7, -1,
                7, 7,
            ],
        )
    }

    #[test]
    fn discussion_case3() {
        test(
            "12+34-56*78+90",
            &[
                -9362, -4412, -3684, -4232, -1614, -9362, -4412, -1680, -1680, -4232, -1614, -4232,
                -690, -690,
            ],
        )
    }
}
