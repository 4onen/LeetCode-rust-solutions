// https://leetcode.com/problems/count-and-say/

pub struct Solution;

// Solution 1: String iteration plus LUT
// impl Solution {
//     pub fn count_and_say(n: i32) -> String {
//         const COUNT_AND_SAY_LUT: &[&str] = &[
//             "",
//             "1",
//             "11",
//             "21",
//             "1211",
//             "111221",
//             "312211",
//             "13112221",
//             "1113213211",
//             "31131211131221",
//             "13211311123113112211",
//             "11131221133112132113212221",
//             "3113112221232112111312211312113211",
//             "1321132132111213122112311311222113111221131221",
//             "11131221131211131231121113112221121321132132211331222113112211",
//             "311311222113111231131112132112311321322112111312211312111322212311322113212221",
//             "132113213221133112132113311211131221121321131211132221123113112221131112311332111213211322211312113211",
//         ];
//         let n = n as u8;
//         let mut prev = COUNT_AND_SAY_LUT
//             [std::cmp::min(n, COUNT_AND_SAY_LUT.len() as u8 - 1u8) as usize]
//             .to_string();
//         for _ in COUNT_AND_SAY_LUT.len() as u8..=n {
//             let mut next = String::with_capacity(prev.len() * 2);
//             let mut bytes = prev.bytes();
//             let mut prev_char = bytes.next().unwrap();
//             let mut count = 1;
//             for c in bytes {
//                 if c == prev_char {
//                     count += 1;
//                 } else {
//                     next.push_str(&count.to_string());
//                     next.push(prev_char as char);
//                     prev_char = c;
//                     count = 1;
//                 }
//             }
//             next.push_str(&count.to_string());
//             next.push(prev_char as char);
//             prev = next;
//         }
//         prev
//     }
// }

// Solution 2: u8 iteration
impl Solution {
    pub fn count_and_say(n: i32) -> String {
        let n = n as usize;
        let mut prev = vec![1u8];
        for _ in 1..n {
            let mut next = Vec::with_capacity(prev.len() * 2);
            let mut prev_digit = prev[0];
            let mut count = 1;
            for digit in prev.into_iter().skip(1) {
                if digit == prev_digit {
                    count += 1;
                } else {
                    next.push(count);
                    next.push(prev_digit);
                    prev_digit = digit;
                    count = 1;
                }
            }
            next.push(count);
            next.push(prev_digit);
            prev = next;
        }
        prev.into_iter()
            .map(|digit| (digit + b'0') as char)
            .collect()
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn ex1() {
        assert_eq!(Solution::count_and_say(1), "1");
    }

    #[test]
    fn ex2() {
        assert_eq!(Solution::count_and_say(4), "1211");
    }

    #[test]
    fn case2() {
        assert_eq!(Solution::count_and_say(2), "11");
    }

    #[test]
    fn case3() {
        assert_eq!(Solution::count_and_say(3), "21");
    }

    #[test]
    fn case5() {
        assert_eq!(Solution::count_and_say(5), "111221");
    }

    #[test]
    fn case6() {
        assert_eq!(Solution::count_and_say(6), "312211");
    }

    #[test]
    fn case7() {
        assert_eq!(Solution::count_and_say(7), "13112221");
    }

    #[test]
    fn case8() {
        assert_eq!(Solution::count_and_say(8), "1113213211");
    }

    #[test]
    fn case9() {
        assert_eq!(Solution::count_and_say(9), "31131211131221");
    }

    #[test]
    fn case30() {
        assert_eq!(
            Solution::count_and_say(30),
            "3113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112212211131221121321131211132221123113112221131112311332211211133112111311222112111312211311123113322112111312211312111322212321121113121112133221121321132132211331121321132213211231132132211211131221232112111312212221121123222112311311222113111231133211121321321122111312211312111322211213211321322123211211131211121332211231131122211311123113321112131221123113111231121123222112111331121113112221121113122113111231133221121113122113121113221112131221123113111231121123222112111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321132132211322132113213221123113112221133112132123222112111312211312112213211231132132211211131221131211322113321132211221121332211231131122211311123113321112131221123113111231121113311211131221121321131211132221123113112211121312211231131122211211133112111311222112111312211312111322211213211321223112111311222112132113213221133122211311221122111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321132132211322132113213221123113112221133112132123222112111312211312112213211231132132211211131221131211322113321132211221121332211213211321322113311213212312311211131122211213211331121321123123211231131122211211131221131112311332211213211321223112111311222112132113213221123123211231132132211231131122211311123113322112111312211312111322111213122112311311123112112322211213211321322113312211223113112221121113122113111231133221121321132132211331222113321112131122211332113221122112133221123113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112311332111213122112311311123112112322211322311311222113111231133211121312211231131112311211232221121113122113121113222123211211131221132211131221121321131211132221123113112211121312211231131122113221122112133221121321132132211331121321231231121113121113122122311311222113111231133221121113122113121113221112131221123113111231121123222112132113213221133112132123123112111312211322311211133112111312211213211311123113223112111321322123122113222122211211232221121113122113121113222123211211131211121311121321123113213221121113122123211211131221121311121312211213211321322112311311222113311213212322211211131221131211221321123113213221121113122113121113222112131112131221121321131211132221121321132132211331121321232221123113112221131112311322311211131122211213211331121321122112133221121113122113121113222123112221221321132132211231131122211331121321232221121113122113121113222123211211131211121332211213111213122112132113121113222112132113213221232112111312111213322112132113213221133112132123123112111311222112132113311213211221121332211231131122211311123113321112131221123113112221132231131122211211131221131112311332211213211321223112111311222112132113212221132221222112112322211211131221131211132221232112111312111213111213211231131112311311221122132113213221133112132123222112311311222113111231132231121113112221121321133112132112211213322112111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121311121312211213211312111322211213211321322123211211131211121332211213211321322113311213211322132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321133112132112312321123113112221121113122113111231133221121321132122311211131122211213211321222113222122211211232221123113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112311332111213213211221113122113121113222112132113213221232112111312111213322112132113213221133112132123123112111312211322311211133112111312212221121123222112132113213221133112132123222113223113112221131112311332111213122112311311123112112322211211131221131211132221232112111312111213111213211231132132211211131221131211221321123113213221123113112221131112211322212322211231131122211322111312211312111322211213211321322113311213211331121113122122211211132213211231131122212322211331222113112211"
        );
    }
}
